/*
 Systeemilahendus Datel AS
 http://www.datel.ee
*/
var InAadress;
InAadress=function(Q){function sa(){var a=!1;if(!b)return alert("Missing json init parameters!"),!1;if(b.container){if(null==document.getElementById(b.container))return alert("Container "+b.container+" doesn't exist!"),!1;g=b.container+"Map";b.container="#"+b.container}else return alert("Missing container parameter!"),!1;if(!b.mode)return alert("Missing mode parameter!"),!1;if(isNaN(b.mode)||0>b.mode||4<b.mode)return alert("Incorrect mode parameter!"),!1;if(b.searchLayers){if(!1===b.searchLayers instanceof Array)return alert("Incorrect searchLayers parameter. Must be array of layer names!"),
!1;b.searchLayers.forEach(function(b){if(0>ca.indexOf(b))return alert("unknown searchLayer: "+b+"!"),a=!0,!1})}if(b.WMS&&!1===b.WMS instanceof Array)return alert("Incorrect WMS parameter. Must be array of WMS url's!"),!1;if(3!=b.mode){if(b.baseLayers){if(!1===b.baseLayers instanceof Array)return alert("Incorrect baseLayers parameter. Must be array of layer names!"),!1;var c;b.baseLayers.forEach(function(b){if(!da[b])return c=b,a=!0,!1});if(c)return alert("unknown baseLayer: "+c+"!"),!1}else return alert("Missing baseLayers parameter!"),
!1;if(!b.defaultBaseLayer)return alert("missing defaultBaseLayer parameter!"),!1;if(b.defaultBaseLayer&&0>b.baseLayers.indexOf(b.defaultBaseLayer))return alert("unknown defaultBaseLayer: "+b.defaultBaseLayer+"!"),!1;if(b.mapLayers){if(!1===b.mapLayers instanceof Array)return alert("Incorrect mapLayers parameter. Must be array of layer names!"),!1;b.mapLayers.forEach(function(b){if(0>ta.indexOf(b))return alert("unknown mapLayer: "+b+"!"),a=!0,!1})}}if(b.tools){if(!1===b.tools instanceof Array)return alert("Incorrect tools parameter. Must be array of tools's!"),
!1;var h;b.tools.forEach(function(b){if(!z[b])return h=b,a=!0,!1});if(h)return alert("unknown tool: "+h+"!"),!1}if(b.appartment&&(isNaN(b.appartment)||0>b.appartment||2<b.appartment))return alert("Incorrect appartment parameter!"),!1;if(a)return!1;for(var d=0;d<document.scripts.length;d++)if(-1<document.scripts[d].src.indexOf("js/inaadress.js")){p=document.scripts[d].src.substring(0,document.scripts[d].src.indexOf("js/inaadress.js"));A=p+"gazetteer";break}else if(-1<document.scripts[d].src.indexOf("js/inaadress.min.js")){p=
document.scripts[d].src.substring(0,document.scripts[d].src.indexOf("js/inaadress.min.js"));A=p+"gazetteer";break}p||(p=top.location.href,"/"!=p.substring(p.length-1)&&(p+="/"),A=p+"gazetteer");return!0}function ua(){function a(){l.size=l.getCurrentSize();for(var a=0,b=l.layers.length;a<b;a++)l.layers[a].onMapResize();a=l.getCachedCenter();null!=l.baseLayer&&null!=a&&(b=l.getZoom(),l.zoom=null,l.setCenter(a,b))}OpenLayers.Map.prototype.updateSize=function(){var b=this.getCurrentSize();if(b&&!isNaN(b.h)&&
!isNaN(b.w)){this.events.clearMouseCache();var c=this.getSize();null==c&&(this.size=c=b);b.equals(c)||(R&&clearTimeout(R),R=setTimeout(a,500))}}}function H(){return!0===b.fullscreenMode&&(b.mode==q.mapSearch||b.mode==q.mapOnly)}function va(){S(p+"theme/default/inaadress.css?ver="+L);S(p+"theme/default/style.mobile.css?ver="+L);b.nocss||S(p+"theme/default/jquery.mobile-1.4.3.css?ver="+L);M(p+"js/proj4js-compressed.js",function(){M(p+"js/OpenLayers.min.js",function(){M(p+"js/jquery.min.js",function(){c=
jQuery.noConflict();c("html").hasClass("ui-mobile")&&(ea=!1);c(document).bind("mobileinit",function(){c.mobile.pushStateEnabled=!1;c.mobile.hashListeningEnabled=!1;c.mobile.linkBindingEnabled=!1;c.mobile.ajaxEnabled=!1;c.mobile.autoInitializePage=!1});M(p+"js/jquery.mobile-1.4.3.min.js",function(){ua();ea&&(c("html").removeClass("ui-mobile"),c(b.container).addClass("ui-mobile"));b.lang&&(e=b.lang);c(b.container).addClass("ui-page-theme-a in-address-container");(b.mode==q.mapSearch||b.mode==q.mapSearchHidden||
b.mode==q.mapOnly)&&c(b.container).height()&&(B=c(b.container).height());b.mode!=q.mapSearch&&b.mode!=q.mapSearchHidden&&b.mode!=q.addressSearch||wa();b.mode!=q.mapSearch&&b.mode!=q.mapSearchHidden&&b.mode!=q.mapOnly||xa();c.mobile.dialog.prototype.options.closeBtnText=e.closeBtnText;c('<div data-role="popup" data-close-btn-text="'+e.closeBtnText+'" class="inAadressInfo ui-page-theme-a" data-close-btn-text data-overlay-theme="a"></div>').appendTo(b.container);r=c(b.container+" .inAadressInfo").popup({closeBtnText:e.closeBtnText});
r.width(500>c(b.container).width()?c(b.container).width()-40+"px":"500px")})})})})}function wa(){var a=c('<div alignt="left"/>').appendTo(b.container);a.addClass("inaadressSearchContainer");a=c("<div/>").appendTo(a);a.addClass("inaadressSearch");var f=c('<ul style="z-index:1100"/>').appendTo(a);f.listview({inset:!0,icon:!1,clearBtnText:e.clear});f.filterable({defaults:!0,filterReveal:!0,filterPlaceholder:e.search,filterTheme:"a"});f.on("filterablebeforefilter",function(a,b){T(c(this),b.input[0].value)});
H()&&f.wrap("<div class='inaadressSearchContainerOuter'></div>");if(b.appartment==C.all||b.appartment==C.allowed)a=c("<select/>").appendTo(a),a.addClass("appartments"),N=a.selectmenu(),c(b.container+" .inaadressSearch .ui-select").hide();b.mode==q.addressSearch&&c('<div class="inAdsCopyright"/>').appendTo(b.container+" .inaadressSearchContainer").html('<a href="'+p+'" target="_blank">In-ADS (Maa-amet)</a>');c(b.container).height(c(b.container+" .inaadressSearchContainer").height());c(b.container+
" .inaadressSearchContainer input").keyup(function(a){13==a.which&&T(f,this.value)});c(b.container+" .inaadressSearchContainer input").focus(function(){H()&&T(f,this.value)});U&&D(U)}function xa(){b.hideLogo&&(u=0);var a=B;H()&&(a=V(),E=String(c("body").attr("style")),F=String(c(b.container).attr("style")),c("body").attr("style","margin:0"),c(b.container).attr("style","z-index:1;position:fixed;top:0;left:0;width:100%;height:"+a+"px"));var f;c(b.container).height(a);0<c(b.container+" .inaadressSearchContainer").length?
(c(b.container+" .inaadressSearchContainer").before('<div id="'+g+'"/>'),f=a-W-u,c(b.container+" #"+g).height(f)):(c("<div/>",{id:g}).appendTo(b.container),c(b.container+" #"+g).height(a-u));c(b.container+" #"+g).css("position","relative");b.hideLogo||c(b.container+" #"+g).before('<a href="'+p+'" target="_blank"><div class="inAadressLogo"/></a>');if(b.baseLayers&&1<b.baseLayers.length){c(b.container+" #"+g).append('<div class="inAadressBaseMap"/>');for(var a='<select class="inAadressBaseMapSelect">',
h=0;h<b.baseLayers.length;h++)a+='<option value="'+b.baseLayers[h]+'" '+(b.baseLayers[h]==b.defaultBaseLayer?"selected":"")+">"+e[b.baseLayers[h]]+"</option>";a+="</select>";c(b.container+" .inAadressBaseMap").html(a);c(b.container+" .inAadressBaseMapSelect").selectmenu();c(b.container+" .inAadressBaseMapSelect").change(function(){l.getLayersByName("maaamet")[0].params.LAYERS=fa();l.baseLayer.redraw(!0)})}c(b.container+" #"+g).is(":visible")?(OpenLayers.Control.ScaleLine.prototype.update=function(){var a=
this.map.getResolution();if(a){var b=this.map.getUnits(),h=OpenLayers.INCHES_PER_UNIT,f=this.maxWidth*a*h[b],e=1;!0===this.geodesic&&(e=(this.map.getGeodesicPixelSize().w||1E-6)*this.maxWidth/(f/h.km),f*=e);var w,g;1E5<f?(w=this.topOutUnits,g=this.bottomOutUnits):(w=this.topInUnits,g=this.bottomInUnits);var m=f/h[w],n=f/h[g],f=this.getBarLen(m),ga=this.getBarLen(n),m=f/h[b]*h[w],n=ga/h[b]*h[g],b=m/a/e,a=n/a/e;"visible"==this.eBottom.style.visibility&&(this.eBottom.style.width=Math.round(a)+"px",this.eBottom.innerHTML=
ga+" "+g);"visible"==this.eTop.style.visibility&&(this.eTop.style.width=Math.round(b)+"px",this.eTop.innerHTML=f+" "+w);w=50>b?50:b;c(".scalebarBackground").width(w+20);c(".scalebarBackground").height(c(this.eTop).height()+c(this.eBottom).height()+23);c(".dogisMapScalebar").text("1:"+Math.round(l.getScale()))}},l=new OpenLayers.Map({div:g,theme:null,units:"m",projection:new OpenLayers.Projection("EPSG:3301",{yx:!0}),maxExtent:[345500,6378520,784950,6634140],fractionalZoom:!0,restrictedExtent:[345500,
637E4,784950,663E4],controls:[new OpenLayers.Control.Navigation({dragPanOptions:{enableKinetic:!1},handleRightClicks:!1,mouseWheelOptions:{interval:0}})],layers:[new OpenLayers.Layer.WMS("maaamet",p+"map",null,{DEFAULT_PARAMS:{version:"1.1.1",request:"GetMap",styles:"",layers:fa(),format:"image/png",transparent:!1},singleTile:!0,isBaseLayer:!0,buffer:0,transitionEffect:"resize",maxResolution:"auto",restrictedExtent:[345500,637E4,784950,663E4],maxExtent:[345500,6378520,784950,6634140],ratio:1})]}),
c(b.container+" #"+g).append('<div class="inAadressCopyright">Maa-amet</div>'),l.events.register("moveend",null,function(){var a=l.getExtent(),b=document.createEvent("CustomEvent");b.initCustomEvent("mapNavigate",!0,!0,[a.left.toFixed(2),a.bottom.toFixed(2),a.right.toFixed(2),a.top.toFixed(2)]);document.dispatchEvent(b)}),b.showScale&&(l.addControl(new OpenLayers.Control.ScaleLine({bottomInUnits:""})),c("#"+g).append('<div class="scalebarBackground"></div>'),c("#"+g).append('<div class="dogisMapScalebar"></div>')),
OpenLayers.Icon.prototype.setTooltip=function(a){a&&this.imageDiv.setAttribute("title",a)},ya(),za(),c(window).resize(function(){if(H()){var a=V();c(b.container).height(a);0<c(b.container+" .inaadressSearchContainer").length?(f=a-W-u,c(b.container+" #"+g).height(f),c(b.container+" .inaadressSearch .ui-select").is(":visible")?c(b.container+" .inaadressSearch").width(c(b.container).width()-110):c(b.container+" .inaadressSearch").width(c(b.container).width())):c(b.container+" #"+g).height(a-u)}}),setTimeout(function(){ha()},
100)):alert("InADS container must be visible during initialisation!")}function ya(){if(b.WMS)for(var a=0;a<b.WMS.length;a++){var c=b.WMS[a].split("?");2!=c.length&&alert("Invalid third party WMS url");var h=c[1].toLowerCase().split("layers=");2!=h.length&&alert("Missing third party WMS layers");var h=h[1].split("&")[0],d=c[1].toLowerCase().split("version=");2!=d.length&&alert("Missing third party WMS version number");d=d[1].split("&")[0];c=new OpenLayers.Layer.WMS("thirdparty_"+a,c[0],null,{DEFAULT_PARAMS:{version:d,
request:"GetMap",styles:"",layers:h,format:"image/png",transparent:!0},singleTile:!0,isBaseLayer:!1,buffer:0,visibility:1,transitionEffect:"resize",ratio:1});l.addLayers([c])}}function ha(){if(l.projection.getUnits()){l.zoomToMaxExtent();c(b.container+" #"+g).append('<div id="OpenLayers_Control_Zoom_3" class="olControlZoom olControlNoSelect" unselectable="on" style="position: absolute; z-index: 1002;">');c(b.container+" .olControlZoom").append('<a href="#zoomIn" class="olControlZoomIn olButton">+</a>');
c(b.container+" .olControlZoom").append('<a href="#zoomOut" class="olControlZoomOut olButton">\u2212</a>');c(b.container+" .olControlZoom").append('<a title="'+e.infoBtn+'" href="javascript:;" class="inAadressInfoBtn'+(!0===ia?" active":"")+'">i</a>');b.tools&&0<b.tools.length&&c(".inAadressInfoBtn").addClass("corner");b.tools&&1==b.tools.length?Aa(b.tools[0]):b.tools&&1<b.tools.length&&Ba();c(b.container+" .olControlZoomIn").click(function(){l.zoomIn()});c(b.container+" .olControlZoomOut").click(function(){l.zoomOut()});
c(b.container+" .inAadressInfoBtn").click(function(){c(this).toggleClass("active");ja();if(c(b.container+" .inAadressTool").hasClass("active")){c(b.container+" .inAadressTool").removeClass("active");var a=document.createEvent("CustomEvent");a.initCustomEvent("unSelectedTool",!0,!0,null);document.dispatchEvent(a);I()}});if(b.mode==q.mapSearchHidden){c(b.container+" .inaadressSearchContainer").before('<div id="showHideMap"><input id="showHideMapBtn" type="button" value="'+(X?e.hidemap:e.showmap)+'">');
c(b.container+" #showHideMapBtn").button({mini:!0});var a=B-c(b.container+" .inaadressSearchContainer").height()-c(b.container+" #showHideMap").height()-u;c(b.container+" #"+g).height(a);X||(c(b.container+" #"+g).hide(),c(b.container).height(c(b.container+" #showHideMap").height()+c(b.container+" .inaadressSearchContainer").height()+u));c(b.container+" #showHideMapBtn").click(function(){c(b.container+" #"+g).toggle();c(b.container).height(c(b.container+" #"+g).is(":visible")?B:c(b.container+" #showHideMap").height()+
c(b.container+" .inaadressSearchContainer form").height()+u);c(b.container+" #showHideMapBtn").val(c(b.container+" #showHideMapBtn").val()==e.showmap?e.hidemap:e.showmap);c(b.container+" #showHideMapBtn").button("refresh")})}n=new OpenLayers.Layer.Markers("MarkerLayer");l.addLayers([n]);a=document.createEvent("CustomEvent");a.initCustomEvent("inaadressLoaded",!0,!0,null);document.dispatchEvent(a);b.mode==q.mapOnly&&b.ads_oid&&ka(b.ads_oid,b.bbox)}else setTimeout(function(){ha()},100)}function Aa(a){-1<
a.indexOf(z.measure)?c(b.container+" .olControlZoom").append('<a title="'+e.measureBtn+'" href="javascript:;" class="inAadressMeasure inAadressTool"></a>'):-1<a.indexOf(z.edit)?c(b.container+" .olControlZoom").append('<a title="'+e.editBtn+'" href="javascript:;" class="inAadressEdit inAadressTool"></a>'):-1<a.indexOf(z.draw)&&c(b.container+" .olControlZoom").append('<a title="'+e.drawBtn+'" href="javascript:;" class="inAadressDraw inAadressTool"></a>');c(b.container+" .inAadressTool").click(function(){c(b.container+
" .inAadressInfoBtn").removeClass("active");c(this).toggleClass("active");var a;c(this).hasClass("active")?c(this).hasClass("inAadressEdit")?(a=document.createEvent("CustomEvent"),a.initCustomEvent("editToolSelected",!0,!0,null),document.dispatchEvent(a)):c(this).hasClass("inAadressDraw")?(a=document.createEvent("CustomEvent"),a.initCustomEvent("drawToolSelected",!0,!0,null),document.dispatchEvent(a)):c(this).hasClass("inAadressMeasure")&&la():(a=document.createEvent("CustomEvent"),a.initCustomEvent("unSelectedTool",
!0,!0,null),document.dispatchEvent(a),I())})}function Ba(){c(b.container+" .olControlZoom").append('<a title="'+e.chooseToolBtn+'" href="javascript:;" class="inAadressToolselector"></a>');c(b.container+" #"+g).append('<div class="olControlTool" style="display: none"></div>');-1<b.tools.indexOf(z.measure)&&c(b.container+" .olControlTool").append('<a title="'+e.measureBtn+'" href="javascript:;" class="inAadressMeasure inAadressTool"></a>');-1<b.tools.indexOf(z.draw)&&c(b.container+" .olControlTool").append('<a title="'+
e.drawBtn+'" href="javascript:;" class="inAadressDraw inAadressTool"></a>');-1<b.tools.indexOf(z.edit)&&c(b.container+" .olControlTool").append('<a title="'+e.editBtn+'" href="javascript:;" class="inAadressEdit inAadressTool"></a>');c(b.container+" .inAadressToolselector").mouseover(function(){c(b.container+" .olControlTool").show()});c(b.container+" .inAadressToolselector").mouseout(function(){c(b.container+" .olControlTool").hide()});c(b.container+" .olControlTool").mouseover(function(){c(b.container+
" .olControlTool").show()});c(b.container+" .olControlTool").mouseout(function(){c(b.container+" .olControlTool").hide()});c(b.container+" .inAadressToolselector").click(function(){c(b.container+" .olControlTool").is(":visible")?c(b.container+" .olControlTool").hide():c(b.container+" .olControlTool").show();ja()});c(b.container+" .inAadressTool").click(function(){c(b.container+" .olControlTool").hide();c(b.container+" .inAadressInfoBtn").removeClass("active");c(b.container+" .inAadressToolselector").removeClass("inAadressMeasure");
c(b.container+" .inAadressToolselector").removeClass("inAadressEdit");c(b.container+" .inAadressToolselector").removeClass("inAadressDraw");c(b.container+" .inAadressToolselector").addClass("active");var a;c(this).hasClass("inAadressEdit")?(c(b.container+" .inAadressToolselector").addClass("inAadressEdit"),a=document.createEvent("CustomEvent"),a.initCustomEvent("editToolSelected",!0,!0,null),document.dispatchEvent(a),I()):c(this).hasClass("inAadressDraw")?(c(b.container+" .inAadressToolselector").addClass("inAadressDraw"),
a=document.createEvent("CustomEvent"),a.initCustomEvent("drawToolSelected",!0,!0,null),document.dispatchEvent(a),I()):c(this).hasClass("inAadressMeasure")&&(c(b.container+" .inAadressToolselector").addClass("inAadressMeasure"),a=document.createEvent("CustomEvent"),a.initCustomEvent("unSelectedTool",!0,!0,null),document.dispatchEvent(a),la())})}function ja(){c(b.container+" .inAadressToolselector").removeClass("inAadressMeasure");c(b.container+" .inAadressToolselector").removeClass("inAadressEdit");
c(b.container+" .inAadressToolselector").removeClass("inAadressDraw");if(c(b.container+" .inAadressToolselector").hasClass("active")){c(b.container+" .inAadressToolselector").removeClass("active");var a=document.createEvent("CustomEvent");a.initCustomEvent("unSelectedTool",!0,!0,null);document.dispatchEvent(a);I()}}function la(){function a(){var a=0,d=0;if(s.handler.line){var f=s.handler.line.geometry;if(2>f.components.length)return;a=f.getLength();if(2<f.components.length){for(var v=new OpenLayers.Geometry.LinearRing,
k=0;k<f.components.length;k++)v.addComponent(f.components[k]);v.addComponent(f.components[0]);d+=v.getArea()}}for(f=0;f<s.layer.features.length;f++)if(a+=s.layer.features[f].geometry.getLength(),2<s.layer.features[f].geometry.components.length){v=new OpenLayers.Geometry.LinearRing;for(k=0;k<s.layer.features[f].geometry.components.length;k++)v.addComponent(s.layer.features[f].geometry.components[k]);v.addComponent(s.layer.features[f].geometry.components[0]);d+=v.getArea()}a=1E3<a?(a/1E3).toFixed(2)+
"km":a.toFixed(2)+"m";d=Math.abs(d);1E6<d?d=(d/1E6).toFixed(2)+"km<sup>2</sup>":0<d&&(d=d.toFixed(2)+"m<sup>2</sup>");c(b.container+" .measureResults").html(e.measureLine+": "+a);d&&0!=d&&c(b.container+" .measureResults").append("<br/>"+e.measureArea+": "+d)}if(s)s.activate(),c(b.container+" .measureResults").html(""),c(b.container+" .measureResults").show();else{c("#"+g).append('<div class="measureResults"></div>');G=new OpenLayers.Layer.Vector("Measure");var f=new OpenLayers.Style({pointRadius:5,
graphicName:"circle",strokeWidth:2,strokeOpacity:1,fillOpacity:.3,fillColor:"#FFFFFF",strokeColor:"#FF0000"});G.styleMap=new OpenLayers.StyleMap({"default":f,temporary:f,select:f});G.events.register("sketchmodified",void 0,a);l.addLayers([G]);s=new OpenLayers.Control.DrawFeature(G,OpenLayers.Handler.Path);l.addControl(s);s.activate()}}function I(){s&&(s.deactivate(),G.removeAllFeatures(),c(b.container+" .measureResults").hide())}function fa(){var a=c(b.container+" .inAadressBaseMapSelect option:selected").val();
a||(a=b.defaultBaseLayer);a=""+da[a];a+=b.mapLayers&&-1<b.mapLayers.indexOf("KATASTRIYKSUS")?",TOPOYKSUS_6569":"";return a+=b.mapLayers&&-1<b.mapLayers.indexOf("AADRESS")?",aadr":""}function za(){OpenLayers.Control.Click=OpenLayers.Class(OpenLayers.Control,{defaultHandlerOptions:{single:!0,"double":!1,pixelTolerance:0,stopSingle:!1,stopDouble:!1},initialize:function(a){this.handlerOptions=OpenLayers.Util.extend({},this.defaultHandlerOptions);OpenLayers.Control.prototype.initialize.apply(this,arguments);
this.handler=new OpenLayers.Handler.Click(this,{click:this.trigger},this.handlerOptions)},trigger:function(a){if(!(b.mode==q.mapOnly&&b.ads_oid&&!c(b.container+" .inAadressInfoBtn").hasClass("active")||c(b.container+" .inAadressToolselector").hasClass("active")||c(b.container+" .inAadressTool").hasClass("active"))){c(b.container+" .inAadressInfoBtn").hasClass("active")||n.clearMarkers();a=l.getLonLatFromPixel(a.xy);var f=b.searchLayers&&0<b.searchLayers.length?b.searchLayers.join(","):"";b.mode==
q.mapOnly&&(f=ca.join(","));Y=a;c.ajax({url:A,dataType:"jsonp",crossDomain:!0,seq:x,cache:!0,data:{features:f,appartment:null!=b.appartment?b.appartment:"0",x:a.lon,y:a.lat}}).then(function(a){if(null!=a){var d=a.addresses;if(a.error)alert(a.error);else if(d&&0<d.length)if(d=ma(d),c(b.container+" .inAadressInfoBtn").hasClass("active")){var f='<div class="inAdsInfoContent" style="max-height: '+(c(b.container+" #"+g).height()-10)+'px">',v=!1;c.each(d,function(a,b){if(b){if(v)return!0;b.showaadress=
J(b.taisaadress);var c=b.ads_oid.substring(0,2);if("LO"==c||"AY"==c||"OV"==c||"MK"==c)v=!0;f+='<table class="info_'+c+'">';f+="<tr><td>"+e.infoAadress+":</td><td>";c=b.showaadress.split(",");f+="<b>"+c[0]+"</b>"+(1<c.length?", "+c.slice(1).join(","):"");f+="</td></tr>";f+="<tr><td>"+e.infoLiik+":</td><td>"+na(b.liikVal,b.ads_oid)+"</td></tr>";f+="<tr><td>"+e.infoTunnus+":</td><td>"+b.tunnus+"</td></tr>";f+="<tr><td>"+e.infoAds+":</td><td>"+b.ads_oid+"</td></tr>";f+="</table>"}});f+="</div>";r.html('<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">'+
e.closeBtnText+"</a>"+f).popup("open",{positionTo:"#"+g})}else{if(b.mode!=q.mapOnly||!b.ads_oid)if(O(),d=Ca(d),1==d.length)d[0].showaadress=J(d[0].taisaadress),d[0].complete=!0,t(d[0]),D(d[0].showaadress),K(d[0],null,!0,0,Y),Z(d[0]),c(b.container+" .inaadressSearch ul").html("");else if(1<d.length){var k='<div class="inAdsInfoContent" style="max-height: '+(c(b.container+" #"+g).height()-10)+'px"><h3>'+e.addressQuestion+'</h3><table class="inAdressSelectTable">',l=0,w=!0,m=d[0].taisaadress;c.each(d,
function(a,b){b.taisaadress!=m&&(w=!1)});c.each(d,function(a,c){c&&(c.showaadress=J(c.taisaadress),k+='<tr value="'+l+'">',k+='<td><input type="radio" name="inAdsSelectAddress" value="'+l+'" id="inAdsSelect_'+l+'"></td>',k+='<td><label for="inAdsSelect_'+l+'">'+(b.searchLayers&&0<b.searchLayers.length?$(c.liikVal,c.ads_oid)+" - ":"")+c.showaadress,k+=(w?" ("+c.ads_oid+")":"")+"</label></td>",k+="</tr>",l++)});k+="</table></div>";k+='<input type="button" class="inAdsSelectBtn" value="'+e.addressOk+
'">';r.html('<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>'+k);r.popup("open",{positionTo:"#"+g});c(".inAdsInfoContent tr").mouseenter(function(){var a=d[c(this).attr("value")];a.viitepunkt_x&&a.viitepunkt_y&&(c(".inAadressInfo").addClass("inAadressPopupTransparent"),a=aa(a.viitepunkt_x,a.viitepunkt_y,p+"theme/default/img/temp/star.png",null,a),n.clearMarkers(),n.addMarker(a))});c(".inAdsInfoContent tr").mouseleave(function(){n.clearMarkers();
c(".inAadressInfo").removeClass("inAadressPopupTransparent")});c(".inAdsSelectBtn").button();c(".inAdsSelectBtn").click(function(){var a=d[c("input[name='inAdsSelectAddress']:checked").val()];a.complete=!0;t(a);D(a.showaadress);K(a,null,!0,0,Y);Z(a);c(b.container+" .inaadressSearch ul").html("");r.popup("close")})}}else c(b.container+" .inAadressInfoBtn").hasClass("active")||(D(""),O(),c(b.container+" .inaadressSearch ul").html(""),c("<li/>").appendTo(c(b.container+" .inaadressSearch ul")).append('<a href="javascript:;" title="'+
e.noresults+'">'+e.noresults+"</a>"),c(b.container+" .inaadressSearch ul").listview("refresh"),c(b.container+" .inaadressSearch ul").trigger("updatelayout"))}})}}});ba=new OpenLayers.Control.Click;l.addControl(ba);ba.activate()}function J(a){a=a.split(",");a.reverse();for(var b=0;b<a.length;b++)a[b]=c.trim(a[b]);return a=a.join(", ")}function ma(a){for(var b=0;b<a.length;b++)for(var c=a.length-1;c>b;c--)a[b].ads_oid==a[c].ads_oid&&(a[b].oidAddresses||(a[b].oidAddresses=[]),a[b].oidAddresses.push(a[c]),
a.splice(c,1));return a}function Ca(a){for(var b=a[0].liikVal,c=a.length-1;0<=c;c--)22.4506281793337<l.getResolution()?"EHAK"!=a[c].liikVal&&"VAIKEKOHT"!=a[c].liikVal&&a.splice(c,1):1.87462745297436<l.getResolution()?"EHITISHOONE"!=a[c].liikVal&&"EHITIS"!=a[c].liikVal&&"HOONE"!=a[c].liikVal||a.splice(c,1):a[c].liikVal!=b&&a.splice(c,1);return a}function T(a,f){O();a.html("");n&&n.clearMarkers();if(f&&0<f.length){a.html("<li><div class='ui-loader'><span class='ui-icon ui-icon-loading'></span></div></li>");
a.listview("refresh");x++;var h=b.searchLayers&&0<b.searchLayers.length?b.searchLayers.join(","):"";c.ajax({url:A,dataType:"jsonp",crossDomain:!0,seq:x,cache:!0,data:{address:f,results:Da,appartment:null!=b.appartment?b.appartment:"0",unik:!0==b.unHoone&&b.searchLayers&&0<b.searchLayers.length?"1":"0",features:h}}).then(function(d){if(this.seq==x&&(a.html(""),null!=d)){var f=d.addresses;if(d.error)alert(d.error);else{if(f&&0<f.length){var h=0,k;c.each(f,function(d,e){if(e&&e.pikkaadress){for(var g=
e.pikkaadress.split(","),m=0;m<g.length;m++)g[m]=c.trim(g[m]);!e.kort_nr||b.appartment!=C.all&&b.appartment!=C.allowed||(g[g.length-1]+="-"+e.kort_nr,e.kort_ads_oid&&(e.pikkaadress=g.join(", ")));g.reverse();e.showaadress=g.join(", ");e.old_aadresstekst&&e.old_aadresstekst!=e.aadresstekst&&(e.showaadress="("+e.old_aadresstekst+") "+e.showaadress);var g=c("<li/>").appendTo(a),r=h;g.click(function(){K(e,e.boundingbox,!0,f.length<=P?r:0);Z(e);t(e);1==h&&(D(e.showaadress),a.html(""));H()&&a.html("")});
b.mode!=q.addressSearch&&(g.mouseenter(function(){for(var a=0;a<n.markers.length;a++)if(n.markers[a].attributes.tehn_id2==e.tehn_id2){var b=aa(null,null,n.markers[a].icon.url,n.markers[a].lonlat,n.markers[a].attributes);b.icon.origUrl=b.icon.url;b.icon.url=b.icon.origUrl.substring(0,b.icon.origUrl.lastIndexOf("/"))+"/temp/"+b.icon.origUrl.substring(b.icon.origUrl.lastIndexOf("/")+1);n.removeMarker(n.markers[a]);n.addMarker(b);break}}),g.mouseleave(function(){for(var a=0;a<n.markers.length;a++)if(n.markers[a].attributes.tehn_id2==
e.tehn_id2&&n.markers[a].icon.origUrl){n.markers[a].icon.url=n.markers[a].icon.origUrl;var b=l.getLayerPxFromLonLat(n.markers[a].lonlat);n.markers[a].icon.draw(b)}}));m="";b.mode!=q.addressSearch&&f.length<=P&&e.viitepunkt_x&&e.viitepunkt_y&&(m='<img src="'+p+"theme/default/img/"+(26>f.length?"letter_"+oa[h]+".png":"star.png")+'" class="ui-li-icon ui-corner-none">');g.append('<a id="in_teh_'+e.tehn_id2+'" href="javascript:;" title="'+e.showaadress+'">'+m+" "+(b.searchLayers&&0<b.searchLayers.length?
$(e.liikVal,e.kort_ads_oid?e.kort_ads_oid:e.ads_oid)+" - ":"")+e.showaadress+"</a>");f.length<=P&&K(e,null,!1,h);e.boundingbox&&(g=e.boundingbox.split(" "),k?(k.left>Number(g[0].split(",")[0])&&(k.left=Number(g[0].split(",")[0])),k.top<Number(g[2].split(",")[1])&&(k.top=Number(g[2].split(",")[1])),k.right<Number(g[2].split(",")[0])&&(k.right=Number(g[2].split(",")[0])),k.bottom>Number(g[0].split(",")[1])&&(k.bottom=Number(g[0].split(",")[1]))):k=new OpenLayers.Bounds(g[0].split(",")[0],g[0].split(",")[1],
g[2].split(",")[0],g[2].split(",")[1]));h++}});f.length<=P&&k&&l&&(d=.2*(k.right-k.left),k.left-=d,k.right+=d,d=.2*(k.top-k.bottom),k.bottom-=d,k.top+=d,l.zoomToExtent(k,!1))}else c("<li/>").appendTo(a).append('<a href="javascript:;" title="'+e.noresults+'">'+e.noresults+"</a>");a.listview("refresh");a.trigger("updatelayout")}}})}}function K(a,c,h,d,e){if(b.mode!=q.addressSearch){if(a.viitepunkt_x&&a.viitepunkt_y||e)a=aa(a.viitepunkt_x,a.viitepunkt_y,p+"theme/default/img/"+(0>d?"star.png":d?"letter_"+
oa[d]+".png":"letter_a.png"),e,a),n&&(h&&n.clearMarkers(),n.addMarker(a));c&&l&&(c=c.split(" "),c=new OpenLayers.Bounds(c[0].split(",")[0],c[0].split(",")[1],c[2].split(",")[0],c[2].split(",")[1]),l.zoomToExtent(c,!1))}}function aa(a,f,h,d,y){a=new OpenLayers.LonLat(a,f);h=new OpenLayers.Icon(h,{w:32,h:37},{x:-16,y:-37});h.setTooltip($(y.liikVal,y.kort_ads_oid?y.kort_ads_oid:y.ads_oid)+" - "+J(y.taisaadress)+" ("+y.ads_oid+")");d=new OpenLayers.Marker(d?d:a,h);d.attributes=y;d.events.register("click",
d,function(){if(c(b.container+" .inAadressInfoBtn").hasClass("active")&&this.attributes){var a='<div class="inAdsInfoContent" style="max-height: '+(c(b.container+" #"+g).height()-10)+'px">';this.attributes.showaadress=J(this.attributes.taisaadress);var d=this.attributes.ads_oid.substring(0,2),a=a+('<table class="info_'+d+'">')+("<tr><td>"+e.infoAadress+":</td><td>"),d=this.attributes.showaadress.split(","),a=a+("<b>"+d[0]+"</b>"+(1<d.length?", "+d.slice(1).join(","):"")),a=a+"</td></tr>",a=a+("<tr><td>"+
e.infoLiik+":</td><td>"+na(this.attributes.liikVal,this.attributes.ads_oid)+"</td></tr>"),a=a+("<tr><td>"+e.infoTunnus+":</td><td>"+this.attributes.tunnus+"</td></tr>"),a=a+("<tr><td>"+e.infoAds+":</td><td>"+this.attributes.ads_oid+"</td></tr>"),a=a+"</table>",a=a+"</div>";r.html('<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">'+e.closeBtnText+"</a>"+a).popup("open",{positionTo:"#"+g})}else t(this.attributes)});d.events.register("mouseover",
d,function(){0<c(b.container+' a[id="in_teh_'+this.attributes.tehn_id2+'"').length&&c(b.container+' a[id="in_teh_'+this.attributes.tehn_id2+'"').addClass("active")});d.events.register("mouseout",d,function(){0<c(b.container+' a[id="in_teh_'+this.attributes.tehn_id2+'"').length&&c(b.container+' a[id="in_teh_'+this.attributes.tehn_id2+'"').removeClass("active")});return d}function pa(a,f,h){a&&!a.ads_oid?(a.complete=!0,t(a)):(x++,c.ajax({url:A,dataType:"jsonp",crossDomain:!0,cache:!0,seq:x,data:{adsoid:null==
f?a.kort_ads_oid?a.kort_ads_oid:a.ads_oid:f,unik:!0==b.unHoone&&b.searchLayers&&0<b.searchLayers.length?"1":"0"}}).then(function(d){if(this.seq==x&&null!=d){var e=d.addresses;if(d.error)alert(d.error);else if(f){r&&r.popup("close");e=ma(e);d=null;for(var g=0;g<e.length;g++)if(e[g].complete=!0,e[g].showaadress=e[g].pikkaadress,K(e[g],null,!1,b.mode==q.mapOnly||26<=e.length?-1:g),e[g].boundingbox&&(!h||!isNaN(h))){var k=e[g].boundingbox.split(" ");d?d&&(d.left>Number(k[0].split(",")[0])&&(d.left=Number(k[0].split(",")[0])),
d.top<Number(k[2].split(",")[1])&&(d.top=Number(k[2].split(",")[1])),d.right<Number(k[2].split(",")[0])&&(d.right=Number(k[2].split(",")[0])),d.bottom>Number(k[0].split(",")[1])&&(d.bottom=Number(k[0].split(",")[1]))):d=new OpenLayers.Bounds(k[0].split(",")[0],k[0].split(",")[1],k[2].split(",")[0],k[2].split(",")[1])}d&&l?(e=isNaN(h)?.2:Number(h),g=(d.right-d.left)*e,d.left-=g,d.right+=g,e*=d.top-d.bottom,d.bottom-=e,d.top+=e,l.zoomToExtent(d,!1)):h&&isNaN(h)&&l&&(h=h.split(","),l.zoomToExtent(new OpenLayers.Bounds(h[0],
h[1],h[2],h[3]),!1))}else e&&1==e.length?(a.taisaadress=a.showaadress=e[0].taisaadress,a.aadresstekst=e[0].aadresstekst,a.pikkaadress=e[0].pikkaadress,a.complete=!0,t(a)):e&&1<e.length&&(a.taisaadress=a.showaadress=e[0].taisaadress,a.complete=!0,a.oidAddresses=[],c.each(e,function(b,c){if(c.adr_id&&a.adr_id&&c.adr_id==a.adr_id||c.kort_adr_id&&a.kort_adr_id&&c.kort_adr_id==a.kort_adr_id)return a.aadresstekst=c.aadresstekst,a.pikkaadress=c.pikkaadress,!0;a.kort_nr&&!a.kort_ads_oid&&(c.kort_nr=a.kort_nr);
a.oidAddresses.push(c)}),t(a))}}))}function Ea(a){a.adr_id?(x++,c.ajax({url:A,dataType:"jsonp",crossDomain:!0,cache:!0,seq:x,data:{adrid:a.kort_adr_id?a.kort_adr_id:a.adr_id,unik:!0==b.unHoone&&b.searchLayers&&0<b.searchLayers.length?"1":"0"}}).then(function(b){if(this.seq==x&&null!=b){var h=b.addresses;if(b.error)alert(b.error);else if(h&&0<h.length){a.complete=!0;if(a.kort_nr&&!a.kort_ads_oid)for(b=h.length-1;0<=b;b--)h[b].primary||h.splice(b,1);c.each(h,function(b,c){a.kort_nr&&!a.kort_ads_oid&&
c.primary&&(c.kort_nr=a.kort_nr);a.kort_nr&&a.kort_ads_oid&&a.kort_adr_id&&a.kort_ads_oid==c.kort_ads_oid&&a.kort_adr_id==c.kort_adr_id&&(a.taisaadress=a.showaadress=c.taisaadress);if(c.seosed&&0<c.seosed.length)for(b=0;b<c.seosed.length;b++)a.kort_nr&&!a.kort_ads_oid&&(c.seosed[b].kort_nr=a.kort_nr)});a.adrSeosed=h;t(a)}}})):(a.complete=!0,t(a))}function Z(a){if("E"==a.liik&&!a.kort_nr&&(b.appartment==C.all||b.appartment==C.allowed&&"1"==a.onkort&&a.appartments&&0<a.appartments.length)){c(b.container+
" .inaadressSearch .ui-select").show();var f;f=""+('<option value="" selected>'+e.appartment+"</option>");if(a.appartments)for(var h=0;h<a.appartments.length;h++)f+='<option value="'+h+'">'+a.appartments[h].tahis+(0==a.appartments[h].ads_oid.indexOf("MR")?" (MR)":"")+"</option>";b.appartment==C.all&&(f+='<option value="muu">'+e.customApparment+"</option>");m=a;qa||(qa=!0,c(b.container+" .appartments").bind("change",function(){if(""==this.value)t(m);else if("muu"==this.value){var a='<div class="inAdsInfoContent" style="max-height: '+
(c(b.container+" #"+g).height()-10)+'px"><h3>'+e.appartmentQuestion+"</h3>",a=a+'<input type="text" name="name" class="inAdsAppartText" value="">'+('<input type="button" class="inAdsAppartSelectBtn" value="'+e.appartmentOk+'">'),a=a+"</div>";r.html('<a href="#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-a ui-icon-delete ui-btn-icon-notext ui-btn-right">Close</a>'+a);b.mode==q.addressSearch?r.popup("open"):r.popup("open",{positionTo:"#"+g});c(".inAdsAppartSelectBtn").button();c(".inAdsAppartText").textinput();
c(".inAdsAppartSelectBtn").click(function(){var a=c(".inAdsAppartText").val().trim();if(a){var d;if(m.appartments&&0<m.appartments.length)for(d=0;d<m.appartments.length;d++)if(m.appartments[d].tahis==a){a=jQuery.extend(!0,{},m);delete a.complete;delete a.adrSeosed;delete a.oidAddresses;a.pikkaadress+="-"+m.appartments[d].tahis;a.aadresstekst+="-"+m.appartments[d].tahis;a.kort_nr=m.appartments[d].tahis;a.kort_orig_tunnus=m.appartments[d].tunnus;a.kort_ads_oid=m.appartments[d].ads_oid;a.kort_adob_id=
m.appartments[d].adob_id;a.kort_adr_id=m.appartments[d].adr_id;a.koodaadress=m.appartments[d].koodaadress;a.kort_unik=m.appartments[d].unik;t(a);r.popup("close");c(b.container+" .appartments").val(d);N.selectmenu("refresh");return}0==c(b.container+' .appartments option[value="m'+a+'"]').length&&c(b.container+' .appartments option[value="muu"]').before('<option value="m'+a+'">'+a+"</option>");c(b.container+" .appartments").val("m"+a);N.selectmenu("refresh");var f=jQuery.extend(!0,{},m);f.kort_nr=a;
if(f.oidAddresses)for(d=0;d<f.oidAddresses.length;d++)f.oidAddresses[d].kort_nr=a;if(f.adrSeosed)for(d=f.adrSeosed.length-1;0<=d;d--)if(f.adrSeosed[d].primary){if(f.adrSeosed[d].kort_nr=a,f.adrSeosed[d].seosed)for(var h=0;h<f.adrSeosed[d].seosed.length;h++)f.adrSeosed[d].seosed[h].kort_nr=a}else f.adrSeosed.splice(d,1);t(f);r.popup("close")}})}else a=jQuery.extend(!0,{},m),delete a.complete,delete a.adrSeosed,delete a.oidAddresses,m.appartments&&m.appartments[this.value]?(a.pikkaadress+="-"+m.appartments[this.value].tahis,
a.aadresstekst+="-"+m.appartments[this.value].tahis,a.kort_nr=m.appartments[this.value].tahis,a.kort_orig_tunnus=m.appartments[this.value].tunnus,a.kort_ads_oid=m.appartments[this.value].ads_oid,a.kort_adob_id=m.appartments[this.value].adob_id,a.kort_adr_id=m.appartments[this.value].adr_id,a.koodaadress=m.appartments[this.value].koodaadress,a.kort_unik=m.appartments[this.value].unik):a.kort_nr=this.value.substring(1),t(a)}));c(b.container+" .appartments").html(f);N.selectmenu("refresh");c(b.container+
" .inaadressSearch").width(c(b.container).width()-110)}else O()}function t(a){if(a.complete){var c;if(a.adrSeosed){c=[];for(var h=0;h<a.adrSeosed.length;h++){var d=ra(a.adrSeosed[h]);c.push(d)}}else c=ra(a);document.createEvent&&document.dispatchEvent&&(a=document.createEvent("CustomEvent"),a.initCustomEvent("addressSelected",!0,!0,c),document.dispatchEvent(a))}else b.searchLayers&&0<b.searchLayers.length?pa(a):Ea(a)}function ra(a){var b,c,d;if(a.kort_nr){if(b=a.kort_ads_oid?{aadress:a.pikkaadress,
lahiaadress:a.aadresstekst,liik:a.kort_ads_oid.substring(0,2),kort_nr:a.kort_nr,orig_tunnus:a.kort_orig_tunnus,un_tunnus:a.kort_unik,koodaadress:a.koodaadress,ehak:a.ehak,ehakov:a.ehakov,ehakmk:a.ehakmk,ads_oid:a.kort_ads_oid,adob_id:a.kort_adob_id,adr_id:a.kort_adr_id,hoone_ads_oid:a.ads_oid,x:a.viitepunkt_y?Number(a.viitepunkt_y).toFixed(2):"",y:a.viitepunkt_x?Number(a.viitepunkt_x).toFixed(2):""}:{aadress:a.pikkaadress,lahiaadress:a.aadresstekst,liik:a.ads_oid.substring(0,2),kort_nr:a.kort_nr,
uus_kort:!0,orig_tunnus:a.tunnus,un_tunnus:a.unik,koodaadress:a.koodaadress,ehak:a.ehak,ehakov:a.ehakov,ehakmk:a.ehakmk,ads_oid:a.ads_oid,adob_id:a.adob_id,adr_id:a.adr_id,x:a.viitepunkt_y?Number(a.viitepunkt_y).toFixed(2):"",y:a.viitepunkt_x?Number(a.viitepunkt_x).toFixed(2):""},0<a.taisaadress.indexOf("//")&&(b.paralleelaadress=a.taisaadress),a.primary&&(b.primary=a.primary),a.oidAddresses||a.seosed)for(b.seotud=[],d=a.oidAddresses?a.oidAddresses:a.seosed,c=0;c<d.length;c++)a.kort_ads_oid?b.seotud.push({aadress:d[c].pikkaadress,
lahiaadress:d[c].aadresstekst,liik:d[c].kort_ads_oid.substring(0,2),kort_nr:d[c].kort_nr,orig_tunnus:d[c].kort_orig_tunnus,un_tunnus:d[c].kort_unik,koodaadress:d[c].koodaadress,ehak:a.ehak,ehakov:a.ehakov,ehakmk:a.ehakmk,ads_oid:d[c].kort_ads_oid,adob_id:d[c].kort_adob_id,adr_id:d[c].kort_adr_id,hoone_ads_oid:d[c].ads_oid,x:d[c].viitepunkt_y?Number(d[c].viitepunkt_y).toFixed(2):"",y:d[c].viitepunkt_x?Number(d[c].viitepunkt_x).toFixed(2):""}):b.seotud.push({aadress:d[c].pikkaadress,lahiaadress:d[c].aadresstekst,
liik:d[c].ads_oid.substring(0,2),kort_nr:d[c].kort_nr,uus_kort:!0,orig_tunnus:d[c].tunnus,un_tunnus:d[c].unik,koodaadress:d[c].koodaadress,ehak:a.ehak,ehakov:a.ehakov,ehakmk:a.ehakmk,ads_oid:d[c].ads_oid,adob_id:d[c].adob_id,adr_id:d[c].adr_id,x:d[c].viitepunkt_y?Number(d[c].viitepunkt_y).toFixed(2):"",y:d[c].viitepunkt_x?Number(d[c].viitepunkt_x).toFixed(2):""})}else if(b={aadress:a.pikkaadress,lahiaadress:a.aadresstekst,liik:a.ads_oid.substring(0,2),orig_tunnus:a.tunnus,ads_oid:a.ads_oid,adob_id:a.adob_id,
adr_id:a.adr_id,koodaadress:a.koodaadress,ehak:a.ehak,ehakov:a.ehakov,ehakmk:a.ehakmk,un_tunnus:a.unik,x:a.viitepunkt_y?Number(a.viitepunkt_y).toFixed(2):"",y:a.viitepunkt_x?Number(a.viitepunkt_x).toFixed(2):""},0<a.taisaadress.indexOf("//")&&(b.paralleelaadress=a.taisaadress),a.primary&&(b.primary=a.primary),a.oidAddresses||a.seosed)for(b.seotud=[],d=a.oidAddresses?a.oidAddresses:a.seosed,c=0;c<d.length;c++)b.seotud.push({aadress:d[c].pikkaadress,lahiaadress:d[c].aadresstekst,liik:d[c].ads_oid.substring(0,
2),orig_tunnus:d[c].tunnus,koodaadress:d[c].koodaadress,ehak:d[c].ehak,ehakov:d[c].ehakov,ehakmk:d[c].ehakmk,un_tunnus:d[c].unik,ads_oid:d[c].ads_oid,adob_id:d[c].adob_id,adr_id:d[c].adr_id,x:d[c].viitepunkt_y?Number(d[c].viitepunkt_y).toFixed(2):"",y:d[c].viitepunkt_x?Number(d[c].viitepunkt_x).toFixed(2):""});return b}function O(){c(b.container+" .inaadressSearch .ui-select").hide();c(b.container+" .inaadressSearch").width(c(b.container).width())}function S(a){var b=document.getElementsByTagName("head")[0],
c=document.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=a;b.appendChild(c)}function M(a,b){for(var c=0;c<document.scripts.length;c++)if(0==document.scripts[c].src.indexOf(a)){b&&b();return}var c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.type="text/javascript";d.src=a;b&&(d.onload=b);c.appendChild(d)}function $(a,b){if("AY"==b.substring(0,2)||"OV"==b.substring(0,2)||"MK"==b.substring(0,2)||"LO"==b.substring(0,2))return"H\u00dc";if("LP"==b.substring(0,
2))return"LP";if("CU"==b.substring(0,2))return"K\u00dc";if("EE"==b.substring(0,2)||"ME"==b.substring(0,2))return"H";if("ER"==b.substring(0,2)||"MR"==b.substring(0,2))return"K";if("KATASTRIYKSUS"==a)return"K\u00dc";if("EHAK"==a)return"H\u00dc";if("TANAV"==a)return"LP";if("VAIKEKOHT"==a)return"VK";if("HOONE"==a||"EHITIS"==a||"EHITISHOONE"==a)return"H "}function na(a,b){return"AY"==b.substring(0,2)?e.AY:"OV"==b.substring(0,2)?e.OV:"MK"==b.substring(0,2)?e.MK:"LO"==b.substring(0,2)?e.LO:"LP"==b.substring(0,
2)?e.LP:"CU"==b.substring(0,2)?e.CU:"EE"==b.substring(0,2)||"ME"==b.substring(0,2)?e.HO:"EHAK"==a?e.EHAK:"TANAV"==a?e.LP:"VAIKEKOHT"==a?e.VK:"HOONE"==a||"EHITIS"==a||"EHITISHOONE"==a?e.HO:""}function V(){var a=0,b=window,c=document;"number"==typeof window.innerWidth?a=b.innerHeight:c.documentElement&&(c.documentElement.clientWidth||c.documentElement.clientHeight)?a=c.documentElement.clientHeight:c.body&&(c.body.clientWidth||c.body.clientHeight)&&(a=c.body.clientHeight);return a}function ka(a,b){if(!a)return alert("Missing adsoid!"),
!1;if(!Fa(b))return alert("Invalid BBOX!"),!1;if(!1===a instanceof Array)return alert("Incorrect adsoid parameter. Must be array of adsoid values!"),!1;n&&n.clearMarkers();pa(null,a.join(","),b)}function Fa(a){if(!a||!isNaN(a))return!0;a=a.split(",");if(4!=a.length)return!1;for(var b=0;b<a.length;b++)if(isNaN(a[b]))return!1;return!(Number(a[0])>Number(a[2])||Number(a[1])>Number(a[3]))}function D(a){c(b.container+" input[data-type='search']").val(a);c(b.container+" input[data-type='search']").attr("title",
a);a?c(b.container+" .ui-input-clear").removeClass("ui-input-clear-hidden"):c(b.container+" .ui-input-clear").addClass("ui-input-clear-hidden")}var L="1.2.1",A,p,Da=10,P=5,q={mapSearch:1,mapSearchHidden:2,addressSearch:3,mapOnly:4},ca=["EHITISHOONE","KATASTRIYKSUS","TANAV","VAIKEKOHT","EHAK"],C={allowed:1,all:2},da={ALUSKAART:"BAASKAART,CORINE,KAART24,HALDUSPIIRID,TEED,KYLAD",ORTOFOTO:"EESTIFOTO",HYBRIID:"EESTIFOTO,HYBRID,ADS_HOONE,ADS_HOONE_NR"},ta=["KATASTRIYKSUS","AADRESS"],b=Q,c,l,g,n,x=0,e={search:"otsi aadressi...",
showmap:"kuva kaart",infoBtn:"infop\u00e4ring",hidemap:"peida kaart",clear:"puhasta",appartment:"vali korter",ALUSKAART:"Aluskaart",ORTOFOTO:"Ortofoto",HYBRIID:"H\u00fcbriid",addressQuestion:"Leitud mitu aadressobjekti. Vali aadress",addressOk:"valin aadressi",customApparment:"muu",appartmentQuestion:"Sisestage korteri nr",appartmentOk:"OK",noresults:"Aadresse ei leitud.",closeBtnText:"Sulge",infoAadress:"Aadress",infoLiik:"Liik",infoTunnus:"Tunnus",infoAds:"ADS OID",AY:"Asustus\u00fcksus",OV:"Omavalitsus",
MK:"Maakond",LO:"Linnaosa",HO:"Hoone",LP:"Liikluspind",VK:"V\u00e4ikekoht",CU:"Katastri\u00fcksus",EHAK:"EHAK",measureBtn:"M\u00f5\u00f5tmine",editBtn:"Redigeerimine",drawBtn:"Joonistamine",chooseToolBtn:"Vali t\u00f6\u00f6riist",measureLine:"Joone pikkus",measureArea:"Pindala",editorQuestion:"Kas soovid antud punkti kustutada?",questionYes:"jah",questionNo:"ei"},B=510,u=55,r,N,oa="abcdefghijklmnopqrsztuvwxy".split(""),ia,U,ea=!0,X,z={measure:"measure",draw:"draw",edit:"edit"},s,G,E=null,F=null,W=
46;Q=-1!=navigator.appName.indexOf("Internet Explorer")?-1==navigator.appVersion.indexOf("MSIE 9")&&-1==navigator.appVersion.indexOf("MSIE 1"):!1;if(Q)alert("In-ADS component is not supported by your browser!");else if(sa()){va();var R,Y,ba,qa=!1,m;this.hideResult=function(){c(b.container+" .inaadressSearch ul").html("")};this.setAddress=function(a){c&&c(b.container+" input[data-type='search']")&&0<c(b.container+" input[data-type='search']").length?D(a):U=a};this.showMap=function(){b.mode==q.mapSearchHidden&&
(c&&c(b.container+" #"+g)&&0<c(b.container+" #"+g).length?(c(b.container+" #"+g).show(),c(b.container).height(c(b.container+" #"+g).is(":visible")?B:c(b.container+" #showHideMap").height()+c(b.container+" .inaadressSearchContainer form").height()+u),c(b.container+" #showHideMapBtn").val(c(b.container+" #showHideMapBtn").val()==e.showmap?e.hidemap:e.showmap),c(b.container+" #showHideMapBtn").button("refresh")):X=!0)};this.hideMap=function(){b.mode==q.mapSearchHidden&&(c(b.container+" #"+g).hide(),
c(b.container).height(c(b.container+" #"+g).is(":visible")?B:c(b.container+" #showHideMap").height()+c(b.container+" .inaadressSearchContainer form").height()+u),c(b.container+" #showHideMapBtn").val(c(b.container+" #showHideMapBtn").val()==e.showmap?e.hidemap:e.showmap),c(b.container+" #showHideMapBtn").button("refresh"))};this.searchAddress=function(a,b){ka(a,b)};this.setInfo=function(a){c&&c(b.container+" .inAadressInfoBtn")&&0!=c(b.container+" .inAadressInfoBtn").length?a?c(b.container+" .inAadressInfoBtn").addClass("active"):
c(b.container+" .inAadressInfoBtn").removeClass("active"):ia=a};this.closeInfo=function(){r&&r.popup("close")};this.getMap=function(){return l};this.getLang=function(){return e};this.getMapId=function(){return g};this.toggleFullscreen=function(a){b.fullscreenMode=a;var e=!0===a?V():B;!0===a&&null==E&&null==F?(E=String(c("body").attr("style")),F=String(c(b.container).attr("style")),c("body").attr("style","margin:0"),c(b.container).attr("style","z-index:1;position:fixed;top:0;left:0;width:100%;height:"+
e+"px")):!1===a&&null!=E&&null!=F&&(c("body").attr("style",E),c(b.container).attr("style",F),E=F=null);0<c(b.container+" .inaadressSearchContainer").length?c(b.container+" #"+g).height(e-W-u):c(b.container+" #"+g).height(e-u);l.updateSize()};this.getVersion=function(){return L}}};
