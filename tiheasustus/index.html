<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Tiheasustus</title>
    <script type="text/javascript" src="jquery-2.1.0.min.js"></script>
	<link rel="stylesheet" href="http://openlayers.org/en/v3.2.1/css/ol.css" type="text/css">
    <script src="http://openlayers.org/en/v3.2.1/build/ol.js" type="text/javascript"></script>
    <script type="text/javascript" src="features.js"></script>
	    <script type="text/javascript" src="features2.js"></script>
			    <script type="text/javascript" src="sa_kiht.js"></script>


    <script type="text/javascript" src="proj4.js"></script>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <style>
        html, body, #map {
            height: 100vh;
            margin: 0;
            padding: 0;
        }

    </style>
</head>
<body>
 <div class="container">
    <div class="row"></div>

   <div class="row">
   
    <label>
      <input class='cl' type="checkbox"> Clusters
    </label>
	
    <label>
      <input class='ky' type="checkbox"> Intersecting KÜ (thinness ratio <0.1) 
    </label>
	  <label>
      <input class='sa' type="checkbox"> SA piirkonnad 
    </label>
    <label>
      <input class='ho' type="checkbox"> Hooned
    </label>
	  <label>
      <input class='al' type="checkbox"> Aluskaart
    </label>
   
                
              
   
   </div>
     <div class="row">
<div id="map">

  </div>
    </div>
	  </div>
	    </div>


</div>

<script>
$('.cl').prop('checked', true);
$('.ky').prop('checked', true);
$('.sa').prop('checked', true);

    proj4.defs("EPSG:3301", "+proj=lcc +lat_1=59.33333333333334 +lat_2=58 +lat_0=57.51755393055556 +lon_0=24 +x_0=500000 +y_0=6375000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs");
    var projection = ol.proj.get('EPSG:3301');
	var map = new ol.Map({
        target: document.getElementById('map'),
        view: new ol.View({
            center: [532527.7637350822, 6575706.066542081],
            resolutions: [500.0, 250.0, 125.0, 62.5, 31.25, 15.625, 7.8125, 3.90625, 1.953125, 0.9765625, 0.48828125],
            projection: projection
        })
    });
    map.getView().setZoom(4); 

var tile_hybrid = new ol.layer.Tile({
    title: "Maa-ameti hübriidkaart 2",
    maxResolution: 10000,
    source: new ol.source.TileWMS({
        url: 'http://tiles.maaamet.ee/tm/s/?',
        ratio: 1.05,
        tileGrid: new ol.tilegrid.TileGrid({
            origin: [40500, 5993000],
            resolutions: [4000.0, 2000.0, 1000.0, 500.0, 250.0, 125.0, 62.5, 31.25, 15.625, 7.8125, 3.90625, 1.953125, 0.9765625, 0.48828125]
        }),
        params: {
            TILED: true,
            LAYERS: ['hybriid'],
            FORMAT: 'image/png',
            TRANSPARENT: 'false',
            VERSION: '1.1.1'
        }
    })
});
window.tile_hybrid = tile_hybrid;
  map.addLayer(tile_hybrid);
  var tile_photo = new ol.layer.Tile({
    title: "Maa-ameti fotokaart",
    maxResolution: 10000,
    source: new ol.source.TileWMS({
        attributions: [
            new ol.Attribution({
                html: '<a target="_blank" href="http://geoportaal.maaamet.ee/est/Teenused/Avalik-WMS-teenus-p65.html">Maa-amet</a>&nbsp;&nbsp;&nbsp;&nbsp;'
            })
        ],
        url: 'http://tiles.maaamet.ee/tm/s/?',
        ratio: 1.05,
        tileGrid: new ol.tilegrid.TileGrid({
            origin: [40500, 5993000],
            resolutions: [4000.0, 2000.0, 1000.0, 500.0, 250.0, 125.0, 62.5, 31.25, 15.625, 7.8125, 3.90625, 1.953125, 0.9765625, 0.48828125]
        }),
        params: {
            LAYERS: ['foto'],
            FORMAT: 'image/jpeg',
            TRANSPARENT: 'false',
            VERSION: '1.1.1'
        }
    })
});
window.tile_photo = tile_photo;
  map.addLayer(tile_photo);
  
 

tile_photo.setVisible(false)
	tile_hybrid.setVisible(false)
	
	
	var clusters = new ol.layer.Vector({
        title: 'index',
        source: new ol.source.GeoJSON({
            object: featurecollection
        }),
		style: function (feature) {
        var i = feature.getProperties().export_ky_;
        return [new ol.style.Style({
		fill: new ol.style.Fill({
            color: '#AEDAE8',
			weight: 1
			})
			 })];
    }
    });
	
  map.addLayer(clusters);
  
  	var ky = new ol.layer.Vector({
        title: 'index',
        source: new ol.source.GeoJSON({
            object: featurecollection2
        }),
		style: function (feature) {
        var i = feature.getProperties().export_ky_;
        return [new ol.style.Style({
		fill: new ol.style.Fill({
            color: '#AEBDE8',
			weight: 1
			})
			 })];
    }
    });
	
  map.addLayer(ky);
  
    
  	var sa = new ol.layer.Vector({
        title: 'SA kiht',
        source: new ol.source.GeoJSON({
            object: sa_kiht
        }),
		style: function (feature) {
        var i = feature.getProperties().export_ky_;
        return [new ol.style.Style({
		fill: new ol.style.Fill({
            color: '#66a3ff',
			weight: 1
			})
			 })];
    }
    });
	
  map.addLayer(sa);
  
   var wmsADS = new ol.layer.Image({
    source: new ol.source.ImageWMS({
        url: 'http://kaart.maaamet.ee/wms/aadressid?',
        params: {
            LAYERS:  'ads_hoone',
            VERSION: '1.1.1'
        }
    })
});
window.wmsADS = wmsADS;
  map.addLayer(wmsADS);
  wmsADS.setVisible(false)


var featureOverlay = new ol.FeatureOverlay({
  map: map,
  style: new ol.style.Style({
    stroke: new ol.style.Stroke({
      color: '#319FD3',
      width: 1
    }),
    fill: new ol.style.Fill({
      color: 'rgba(142, 213, 237, 0.9)'
    })
  })
});


var highlight;
var displayFeatureInfo = function(pixel) {

  var feature = map.forEachFeatureAtPixel(pixel, function(feature, layer) {
    return feature;
  });

  if (feature !== highlight) {
    if (highlight) {
      featureOverlay.removeFeature(highlight);
    }
    if (feature) {
      featureOverlay.addFeature(feature);
    }
    highlight = feature;
  }

};
  map.on('pointermove', function(evt) {
  if (evt.dragging) {
    return;
  }
  var pixel = map.getEventPixel(evt.originalEvent);
  displayFeatureInfo(pixel);
});


$('input[type="checkbox"]').click(function () {
 var layerClass = $(this).attr('class')
 console.log(layerClass)
     if (layerClass == "cl") {
		  if (clusters.getVisible()) {
        clusters.setVisible(false);
    } else {
        clusters.setVisible(true);
    }

	}else if (layerClass=="ho") {
	console.log(2)
	
	 if (wmsADS.getVisible()) {
        wmsADS.setVisible(false);
    } else {
        wmsADS.setVisible(true);
    }
	
	
	}else if (layerClass=="sa") {
	console.log(2)
	
	 if (sa.getVisible()) {
        sa.setVisible(false);
    } else {
        sa.setVisible(true);
    }
	
	
	}else if (layerClass=="al") {
	
	
	if (tile_hybrid.getVisible()) {
        tile_hybrid.setVisible(false);
		        tile_photo.setVisible(false);

    } else {
        tile_hybrid.setVisible(true);
		        tile_photo.setVisible(true);

    }
	
	
	}
	
	
	
	
	else if (layerClass== "ky") {
	
	 if (ky.getVisible()) {
        ky.setVisible(false);
    } else {
        ky.setVisible(true);
    }
	
	}
});



</script>
</body>
</html>